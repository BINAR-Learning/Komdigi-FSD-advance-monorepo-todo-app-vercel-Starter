# ===============================================
# TODO: BUAT CI/CD WORKFLOW YAML DARI AWAL
# ===============================================
#
# Tugas Anda: Buat GitHub Actions workflow untuk CI/CD deployment ke Vercel
#
# ===============================================
# REQUIREMENTS & SPESIFIKASI
# ===============================================
#
# 1. WORKFLOW NAME
#    - name: CI/CD Pipeline - Fullstack Vercel Deployment
#
# 2. TRIGGERS (on)
#    - push ke branches: [main, develop]
#    - pull_request ke branches: [main]
#
# 3. JOBS YANG HARUS DIBUAT:
#    
#    A. JOB: test
#       - name: Run Tests
#       - runs-on: ubuntu-latest
#       - Steps:
#         1. Checkout code (actions/checkout@v4)
#         2. Setup Node.js 22 (actions/setup-node@v4)
#         3. Install pnpm (pnpm/action-setup@v4, version: 9.0.0)
#         4. Setup Node.js cache dengan pnpm
#         5. Install dependencies:
#            if [ -f "pnpm-lock.yaml" ]; then
#              pnpm install --frozen-lockfile
#            else
#              pnpm install
#            fi
#         6. Run tests: pnpm test || true
#
#    B. JOB: build-frontend
#       - name: Build Frontend
#       - needs: test
#       - runs-on: ubuntu-latest
#       - if: github.ref == 'refs/heads/main'
#       - Steps:
#         1. Checkout code
#         2. Setup Node.js 22
#         3. Install pnpm
#         4. Setup Node.js cache
#         5. Install dependencies (sama seperti job test)
#         6. Build frontend:
#            pnpm --filter @todo/frontend build
#            env:
#              VITE_API_URL: ${{ secrets.VITE_API_URL }}
#
#    C. JOB: deploy-frontend-vercel
#       - name: Deploy Frontend to Vercel
#       - needs: build-frontend
#       - runs-on: ubuntu-latest
#       - if: github.ref == 'refs/heads/main'
#       - environment: production
#       - Steps:
#         1. Checkout code
#         2. Setup Node.js 22
#         3. Install pnpm
#         4. Setup Node.js cache
#         5. Install dependencies
#         6. Deploy ke Vercel:
#            - Install vercel CLI: npm install -g vercel@latest
#            - Export environment variables:
#              export VERCEL_TOKEN="${{ secrets.VERCEL_TOKEN }}"
#              export VERCEL_USER_ID="${{ secrets.VERCEL_USER_ID }}"
#              export VERCEL_ORG_ID="${{ secrets.VERCEL_ORG_ID }}"
#              export VERCEL_FRONTEND_PROJECT_ID="${{ secrets.VERCEL_FRONTEND_PROJECT_ID }}"
#            - Tentukan scope (team atau personal):
#              if [ -n "$VERCEL_ORG_ID" ]; then
#                SCOPE="$VERCEL_ORG_ID"
#              else
#                SCOPE="$VERCEL_USER_ID"
#              fi
#            - Masuk ke folder frontend: cd apps/frontend
#            - Deploy dengan vercel CLI:
#              if [ -n "$VERCEL_FRONTEND_PROJECT_ID" ]; then
#                echo "Deploying to existing Vercel project..."
#                vercel pull --yes --environment=production --token="$VERCEL_TOKEN" --scope="$SCOPE"
#                vercel build --prod --token="$VERCEL_TOKEN"
#                vercel deploy --prebuilt --prod --token="$VERCEL_TOKEN" --scope="$SCOPE"
#              else
#                echo "Creating new Vercel project..."
#                vercel --prod --token="$VERCEL_TOKEN" --scope="$SCOPE" --yes
#              fi
#            - Set env variables untuk deployment:
#              env:
#                VITE_API_URL: ${{ secrets.VITE_API_URL }}
#
#    D. JOB: deploy-backend-vercel
#       - name: Deploy Backend to Vercel
#       - needs: test
#       - runs-on: ubuntu-latest
#       - if: github.ref == 'refs/heads/main'
#       - environment: production
#       - Steps:
#         1. Checkout code
#         2. Setup Node.js 22
#         3. Install pnpm
#         4. Setup Node.js cache
#         5. Install dependencies
#         6. Deploy ke Vercel:
#            - Install vercel CLI: npm install -g vercel@latest
#            - Export environment variables (sama seperti frontend)
#            - Tentukan scope
#            - Masuk ke folder backend: cd apps/backend
#            - Deploy dengan vercel CLI (sama seperti frontend)
#            - Tambahan untuk backend: Set environment variables di Vercel
#              if [ -n "${{ secrets.MONGODB_URI }}" ]; then
#                vercel env add MONGODB_URI production "${{ secrets.MONGODB_URI }}" --token="$VERCEL_TOKEN" --scope="$SCOPE" --yes || true
#              fi
#              (ulangi untuk JWT_SECRET dan JWT_EXPIRES_IN)
#            - Set env variables:
#              env:
#                NODE_ENV: production
#                MONGODB_URI: ${{ secrets.MONGODB_URI }}
#                JWT_SECRET: ${{ secrets.JWT_SECRET }}
#                JWT_EXPIRES_IN: ${{ secrets.JWT_EXPIRES_IN }}
#
# ===============================================
# GITHUB SECRETS YANG HARUS DIBUAT
# ===============================================
#
# Lokasi: GitHub Repository > Settings > Secrets and variables > Actions
#
# Required Secrets:
# 1. VERCEL_TOKEN
#    - Generate di: https://vercel.com/account/tokens
#    - Scope: Full Account
#    - Cara: Klik "Create Token" > Berikan nama > Copy token
#
# 2. VERCEL_USER_ID
#    - Location: Vercel Settings > General > Your ID
#    - Format: user_xxxxxxxxxxxxxxxxxx
#
# 3. VERCEL_ORG_ID (untuk Team Account)
#    - Location: Vercel Settings > General > Team ID
#    - Format: team_xxxxxxxxxxxxxxxxxx
#    - Untuk personal account: Kosongkan atau sama dengan USER_ID
#
# 4. VERCEL_FRONTEND_PROJECT_ID
#    - Cara dapat:
#      a. Deploy frontend manual ke Vercel (satu kali)
#      b. Buka project di Vercel Dashboard
#      c. Go to Settings > General
#      d. Copy Project ID
#    - Format: prj_xxxxxxxxxxxxxxxxxx
#
# 5. VERCEL_BACKEND_PROJECT_ID
#    - Cara dapat: Sama seperti frontend
#    - Format: prj_xxxxxxxxxxxxxxxxxx
#
# Optional Secrets (akan override Vercel environment variables):
# 6. VITE_API_URL
#    - Backend URL setelah deploy
#    - Contoh: https://your-backend.vercel.app
#
# 7. MONGODB_URI
#    - MongoDB Atlas connection string
#    - Format: mongodb+srv://username:password@cluster.mongodb.net/database
#
# 8. JWT_SECRET
#    - JWT secret key (minimal 32 karakter)
#    - Generate: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# 9. JWT_EXPIRES_IN
#    - JWT expiration time
#    - Default: 7d
#
# ===============================================
# CARA SETUP CI/CD LENGKAP
# ===============================================
#
# Step 1: Setup MongoDB Atlas
# - Daftar di https://cloud.mongodb.com
# - Create cluster (Free Tier M0)
# - Create database user
# - Network Access: Add IP 0.0.0.0/0
# - Get connection string
#
# Step 2: Deploy Manual ke Vercel (Sekali)
# - Frontend:
#   cd apps/frontend
#   vercel --prod
#   (Copy Project ID dari output atau dashboard)
# - Backend:
#   cd apps/backend
#   vercel --prod
#   (Set environment variables: MONGODB_URI, JWT_SECRET, JWT_EXPIRES_IN)
#   (Copy Project ID)
#
# Step 3: Add GitHub Secrets
# - Go to: GitHub Repository > Settings > Secrets and variables > Actions
# - Click "New repository secret"
# - Add semua secrets yang diperlukan (lihat list di atas)
#
# Step 4: Create .github/workflows/ci-cd.yml
# - Buat file ini di root repository
# - Copy struktur dari TODO di atas
# - Tulis YAML sesuai spesifikasi
#
# Step 5: Push ke GitHub
# - git add .
# - git commit -m "feat: add CI/CD workflow"
# - git push origin main
#
# Step 6: Monitor Deployment
# - Go to: GitHub Repository > Actions tab
# - Lihat workflow running
# - Check logs jika ada error
#
# ===============================================
# TIPS & TROUBLESHOOTING
# ===============================================
#
# 1. Jika error "frozen-lockfile":
#    - Run: pnpm install
#    - Commit pnpm-lock.yaml yang baru
#
# 2. Jika Vercel deployment gagal:
#    - Check apakah Project ID benar
#    - Check apakah VERCEL_TOKEN valid
#    - Check apakah SCOPE (ORG_ID/USER_ID) benar
#
# 3. Jika environment variables tidak tersedia:
#    - Set manual di Vercel Dashboard
#    - Project Settings > Environment Variables
#    - Add: MONGODB_URI, JWT_SECRET, JWT_EXPIRES_IN, VITE_API_URL
#
# 4. Untuk test deployment manual:
#    - Gunakan: vercel --prod --debug
#    - Lihat detailed logs
#
# 5. GitHub Actions syntax:
#    - Uses: untuk action dari marketplace
#    - Run: untuk command shell
#    - Env: untuk environment variables
#    - If: untuk conditional execution
#    - Needs: untuk dependency antar jobs
#
# ===============================================
# STRUKTUR YAML YANG BENAR
# ===============================================
#
# name: <workflow-name>
#
# on:
#   <trigger-events>
#
# jobs:
#   <job-name>:
#     name: <display-name>
#     runs-on: <os>
#     needs: <dependency-jobs>    # optional
#     if: <condition>              # optional
#     environment: <env-name>      # optional
#     steps:
#       - name: <step-name>
#         uses: <action>            # atau
#         run: <command>
#         with:                     # untuk uses
#           <param>: <value>
#         env:                      # untuk run
#           <var>: <value>
#
# ===============================================
# CONTOH MINIMAL (UNTUK REFERENSI)
# ===============================================
#
# name: CI/CD Pipeline
# 
# on:
#   push:
#     branches: [main]
# 
# jobs:
#   test:
#     name: Run Tests
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#       - uses: actions/setup-node@v4
#         with:
#           node-version: "22"
#       - name: Install pnpm
#         uses: pnpm/action-setup@v4
#         with:
#           version: 9.0.0
#       - name: Install dependencies
#         run: pnpm install
#       - name: Run tests
#         run: pnpm test
#
# ===============================================
# SELAMAT MENGERJAKAN!
# ===============================================
#
# Referensi:
# - GitHub Actions Docs: https://docs.github.com/en/actions
# - Vercel CLI Docs: https://vercel.com/docs/cli
# - pnpm Docs: https://pnpm.io/
#
# Good luck! ðŸš€
